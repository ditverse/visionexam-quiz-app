@model QuizApp.Models.Quiz
@{
    ViewData["Title"] = $"Quiz: {Model.Title}";
    var attemptId = ViewData["AttemptId"];
    var startedAt = ViewData["StartedAt"];
}

<div class="quiz-take-container">
    <!-- Quiz Header -->
    <div class="quiz-header">
        <div class="quiz-info">
            <h1 class="quiz-title">@Model.Title</h1>
            <div class="quiz-meta">
                <span class="question-counter">Soal <span id="currentQuestion">1</span> dari @Model.Questions.Count</span>
                <span class="quiz-points">@Model.Questions.Sum(q => q.Points) poin total</span>
            </div>
        </div>
        <div class="quiz-timer">
            <div class="timer-display">
                <i class="fas fa-clock"></i>
                <span id="timer">00:00</span>
            </div>
            <div class="timer-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="timerProgress"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="quiz-content">
        <!-- Main Quiz Area -->
        <div class="quiz-main">
            <!-- Question Navigation -->
            <div class="question-nav">
                <div class="nav-header">
                    <h3>Navigasi Soal</h3>
                    <div class="nav-legend">
                        <span class="legend-item current">Saat Ini</span>
                        <span class="legend-item answered">Terjawab</span>
                        <span class="legend-item unanswered">Belum</span>
                    </div>
                </div>
                <div class="nav-grid">
                    @for (int i = 0; i < Model.Questions.Count; i++)
                    {
                        <button class="nav-btn" data-question="@i" onclick="goToQuestion(@i)">
                            @(i + 1)
                        </button>
                    }
                </div>
            </div>

            <!-- Question Display -->
            <div class="question-display">
                @for (int i = 0; i < Model.Questions.Count; i++)
                {
                    var question = Model.Questions[i];
                    var options = System.Text.Json.JsonSerializer.Deserialize<List<string>>(question.OptionsJson) ?? new List<string>();
                    
                    <div class="question-panel" id="question-@i" style="display: @(i == 0 ? "block" : "none")">
                        <div class="question-header">
                            <div class="question-number">Soal @(i + 1)</div>
                            <div class="question-points">@question.Points poin</div>
                        </div>
                        
                        <div class="question-text">
                            <h3>@question.Text</h3>
                        </div>
                        
                        <div class="options-container">
                            @for (int j = 0; j < options.Count; j++)
                            {
                                <div class="option-item">
                                    <input type="radio" name="question-@i" id="option-@i-@j" value="@j" class="option-radio">
                                    <label for="option-@i-@j" class="option-label">
                                        <span class="option-letter">@(char)('A' + j)</span>
                                        <span class="option-text">@options[j]</span>
                                    </label>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>

            <!-- Navigation Buttons -->
            <div class="quiz-navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
                    <i class="fas fa-chevron-left"></i>
                    Sebelumnya
                </button>
                
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">
                    Selanjutnya
                    <i class="fas fa-chevron-right"></i>
                </button>
                
                <button class="btn btn-success" id="submitBtn" onclick="submitQuiz()" style="display: none;">
                    <i class="fas fa-check"></i>
                    Selesai & Submit
                </button>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="quiz-sidebar">
            <!-- Webcam Monitor -->
            <div class="webcam-section">
                <div class="section-header">
                    <h3>
                        <i class="fas fa-video"></i>
                        Webcam Monitor
                    </h3>
                    <div class="status-indicator active">
                        <span class="status-dot"></span>
                        Active
                    </div>
                </div>
                <div class="webcam-view">
                    <video id="webcam" autoplay muted></video>
                    <div class="webcam-overlay">
                        <div class="detection-box">
                            <div class="detection-status">
                                <i class="fas fa-user"></i>
                                <span>Wajah Terdeteksi</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Violations Stats -->
            <div class="violations-stats">
                <div class="section-header">
                    <h3>
                        <i class="fas fa-exclamation-triangle"></i>
                        Statistik Pelanggaran
                    </h3>
                </div>
                <div class="stats-list">
                    <div class="stat-item">
                        <div class="stat-icon left">
                            <i class="fas fa-arrow-left"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Menoleh Kiri</div>
                            <div class="stat-count" id="lookLeftCount">0</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon right">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Menoleh Kanan</div>
                            <div class="stat-count" id="lookRightCount">0</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon no-face">
                            <i class="fas fa-user-slash"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Wajah Tidak Terdeteksi</div>
                            <div class="stat-count" id="noFaceCount">0</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon multi-face">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">Banyak Wajah</div>
                            <div class="stat-count" id="multiFaceCount">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Info -->
            <div class="quiz-info-sidebar">
                <div class="info-item">
                    <i class="fas fa-clock"></i>
                    <div>
                        <div class="info-label">Durasi</div>
                        <div class="info-value">@Model.DurationMinutes menit</div>
                    </div>
                </div>
                <div class="info-item">
                    <i class="fas fa-question-circle"></i>
                    <div>
                        <div class="info-label">Total Soal</div>
                        <div class="info-value">@Model.Questions.Count</div>
                    </div>
                </div>
                <div class="info-item">
                    <i class="fas fa-star"></i>
                    <div>
                        <div class="info-label">Total Poin</div>
                        <div class="info-value">@Model.Questions.Sum(q => q.Points)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Warning Modal -->
    <div class="modal" id="warningModal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Peringatan!</h3>
            </div>
            <div class="modal-body">
                <p id="warningMessage">Anda terdeteksi melakukan aktivitas mencurigakan!</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeWarning()">OK</button>
            </div>
        </div>
    </div>
</div>

<form id="quizForm" asp-controller="Quiz" asp-action="Complete" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" name="attemptId" value="@attemptId" />
    <input type="hidden" id="answersData" name="answers" />
</form>

<link rel="stylesheet" href="~/css/quiz-take.css" />
<script src="~/js/quiz-take.js"></script>