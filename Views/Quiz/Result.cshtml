@model QuizApp.Models.QuizAttempt
@{
    ViewData["Title"] = "Hasil Quiz - VisionExam";
    var percentage = Model.MaxScore > 0 ? (double)Model.Score / Model.MaxScore * 100 : 0;
    var grade = percentage >= 80 ? "A" : percentage >= 70 ? "B" : percentage >= 60 ? "C" : percentage >= 50 ? "D" : "E";
    var gradeColor = percentage >= 80 ? "success" : percentage >= 70 ? "primary" : percentage >= 60 ? "warning" : percentage >= 50 ? "orange" : "danger";
}

<div class="result-container">
    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas"></canvas>

    <!-- Success Header -->
    <div class="result-header">
        <div class="success-animation">
            <div class="success-circle">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
                    <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </div>
        <h1 class="result-title">Quiz Selesai!</h1>
        <p class="result-subtitle">@Model.Quiz?.Title</p>
    </div>

    <!-- Grade Display with Progress Ring -->
    <div class="grade-section">
        <div class="grade-display">
            <div class="grade-progress-ring">
                <svg width="200" height="200">
                    <circle class="grade-progress-ring__circle" stroke="#e5e7eb" stroke-width="8" fill="transparent" r="90" cx="100" cy="100"/>
                    <circle class="grade-progress-ring__circle grade-progress-ring__circle--progress" stroke="url(#gradient)" stroke-width="8" fill="transparent" r="90" cx="100" cy="100"
                            stroke-dasharray="@percentage * 5.65 565" stroke-dashoffset="0"/>
                    <defs>
                        <linearGradient id="gradient">
                            <stop offset="0%" stop-color="#8b5cf6" />
                            <stop offset="100%" stop-color="#3b82f6" />
                        </linearGradient>
                    </defs>
                </svg>
                <div class="grade-content">
                    <div class="grade-letter">@grade</div>
                    <div class="grade-score">@Model.Score / @Model.MaxScore</div>
                    <div class="grade-percentage">(@percentage.ToString("F1")%)</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-question-circle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">@Model.Quiz?.Questions.Count</div>
                <div class="stat-label">Jumlah Soal</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">@((Model.CompletedAt - Model.StartedAt)?.TotalMinutes.ToString("F1"))</div>
                <div class="stat-label">Waktu (menit)</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-bullseye"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">@Model.Score</div>
                <div class="stat-label">Skor Benar</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-chart-pie"></i>
            </div>
            <div class="stat-content">
                <div class="stat-number">@percentage.ToString("F0")%</div>
                <div class="stat-label">Akurasi</div>
            </div>
        </div>
    </div>

    <!-- Violations Section -->
    @if (Model.Violations.Count > 0)
    {
        <div class="violations-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Catatan Pelanggaran (@Model.Violations.Count)
                </h2>
            </div>
            
            <div class="violations-grid">
                @{
                    var lookLeft = Model.Violations.Count(v => v.Type == QuizApp.Models.ViolationType.LookLeft);
                    var lookRight = Model.Violations.Count(v => v.Type == QuizApp.Models.ViolationType.LookRight);
                    var noFace = Model.Violations.Count(v => v.Type == QuizApp.Models.ViolationType.NoFace);
                    var multiFace = Model.Violations.Count(v => v.Type == QuizApp.Models.ViolationType.MultipleFaces);
                }
                
                <div class="violation-card @(lookLeft > 0 ? "violation-active" : "")">
                    <div class="violation-icon">
                        <i class="fas fa-arrow-left"></i>
                    </div>
                    <div class="violation-content">
                        <div class="violation-title">Menoleh Kiri</div>
                        <div class="violation-count">@lookLeft kali</div>
                    </div>
                </div>
                
                <div class="violation-card @(lookRight > 0 ? "violation-active" : "")">
                    <div class="violation-icon">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="violation-content">
                        <div class="violation-title">Menoleh Kanan</div>
                        <div class="violation-count">@lookRight kali</div>
                    </div>
                </div>
                
                <div class="violation-card @(noFace > 0 ? "violation-active" : "")">
                    <div class="violation-icon">
                        <i class="fas fa-user-slash"></i>
                    </div>
                    <div class="violation-content">
                        <div class="violation-title">Wajah Tidak Terdeteksi</div>
                        <div class="violation-count">@noFace kali</div>
                    </div>
                </div>
                
                <div class="violation-card @(multiFace > 0 ? "violation-active" : "")">
                    <div class="violation-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="violation-content">
                        <div class="violation-title">Banyak Wajah</div>
                        <div class="violation-count">@multiFace kali</div>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="clean-section">
            <div class="clean-badge">
                <i class="fas fa-shield-check"></i>
                <span>Tidak Ada Pelanggaran</span>
            </div>
            <p>Selamat! Anda mengerjakan quiz dengan integritas yang baik.</p>
        </div>
    }

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a href="/Quiz" class="btn btn-primary">
            <i class="fas fa-play"></i>
            Quiz Lainnya
        </a>
        <a href="/Quiz/History" class="btn btn-secondary">
            <i class="fas fa-history"></i>
            Riwayat Quiz
        </a>
    </div>
</div>

<link rel="stylesheet" href="~/css/result.css" />
<script src="~/js/result.js"></script>